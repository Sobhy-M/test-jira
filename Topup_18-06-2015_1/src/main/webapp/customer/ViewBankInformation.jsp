

<%@page import="java.util.Map"%>
<%@page import="java.text.DateFormat"%>
<%@page import="java.util.ArrayList"%>
<%--
    Document   : ViewBankInformation.jsp
    Created on : 06/05/2009, 11:09:49 ?
    Author     : Melad
--%>

<%@page import="java.util.Calendar"%>
<%@page import="java.text.SimpleDateFormat"%>
<%@page import="java.util.Date"%>
<%@page contentType="text/html" pageEncoding="UTF-8"%>
<%@page import="com.masary.common.CONFIG"%>
<%@page import="com.masary.database.manager.MasaryManager"%>
<%@page import="com.masary.database.dto.*"%>
<%@page import="java.util.List"%>
<%@page import="java.text.DecimalFormat"%>

<link href="img/style<%=request.getSession().getAttribute(CONFIG.lang)%>.css" rel="stylesheet" type="text/css">
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<% int startOfLoop = 0;
    int endOfLoop = 10;
    List transFromAg = null;
    List transToAg = null;
    List sumOfTrans = null;
    int length;
    int al;
    String newdate;
    String isflag;

Map<String, String> requestParameters = (Map<String, String>) session.getAttribute(CONFIG.REQUEST_PARAMETERS);
%>
<%
    
    String xx = null;
    try {
        xx = requestParameters.get("al");
        if (xx != null) {
            endOfLoop = Integer.parseInt(xx);
        }
    } catch (NullPointerException ex) {
    }
    startOfLoop = endOfLoop - 10;

    String role = (String) request.getSession().getAttribute(CONFIG.PARAM_ROLE);
    if (role == null) {
        response.sendRedirect(CONFIG.APP_ROOT + CONFIG.PAGE_LOGIN);
        return;
    }
%>
<%
    try {
        isflag = requestParameters.get("isflag");
        if (requestParameters.get("isflag").equals("1")) {
            session.setAttribute("newdate", requestParameters.get("date"));
        } else {
            isflag = "0";
            //System.out.println("fllllllag 0");
        }


    } catch (Exception e) {
        isflag = "0";
    }
    session = request.getSession();
    ArrayList<CustomerServiceDTO> serviceList = (ArrayList<CustomerServiceDTO>) session.getAttribute("services");
    transFromAg = (List) session.getAttribute("transFromAg");
    transToAg = (List) session.getAttribute("transToAg");
    sumOfTrans = (List) session.getAttribute("sumOfTrans");
%>

<html>
    <head>
        <style  type="text/css">
            #servDiv {
                overflow: auto;
                azimuth: leftwards;
                height: 205px;
                width: 250px;
                overflow-y: scroll;
                border:1px ; 
            }
        </style>
        <script language="javascript" type="text/javascript" src="agent/datetimepicker.js"></script>
        <script type="text/javascript">
            var fieldID = 'chkName';
            function selectall() {
                var i = document.getTransAg.elements.length;
                var e = document.getTransAg.elements;
                var name = new Array();
                var value = new Array();
                var j = 0;
                for (var k = 0; k < i; k++)
                {
                    if (document.getTransAg.elements[k].id == fieldID)
                    {
                        if (document.getTransAg.elements[k].checked == true) {
                            value[j] = document.getTransAg.elements[k].value;
                            j++;
                        }
                    }
                }
                checkSelect();
            }
            function selectCheck(obj)
            {
                var i = document.getTransAg.elements.length;
                for (var k = 0; k < i; k++)
                {
                    if (document.getTransAg.elements[k].id == fieldID)
                    {
                        document.getTransAg.elements[k].checked = obj;
                    }
                }
                selectall();
            }
            function selectallMe()
            {
                if (document.getTransAg.allCheck.checked == true)
                {
                    selectCheck(true);
                }
                else
                {
                    selectCheck(false);
                }
            }
            function checkSelect()
            {
                var i = document.getTransAg.elements.length;
                var berror = true;
                for (var k = 0; k < i; k++)
                {
                    if (document.getTransAg.elements[k].id == fieldID)
                    {
                        if (document.getTransAg.elements[k].checked == false)
                        {
                            berror = false;
                            break;
                        }
                    }
                }
                if (berror == false)
                {
                    document.getTransAg.allCheck.checked = false;
                }
                else
                {
                    document.getTransAg.allCheck.checked = true;
                }
            }
            var mydiv = document.getElementById('mydiv');

        </script>

        <meta http-equiv="Content-Type" content="text/html; charset=windows-1256">
        <title><%=CONFIG.getTransactions(session)%></title>
    </head>
    <BODY class="body" <%=session.getAttribute("agentServices") == null ? "onload='selectallMe()'" : ""%>  >
        <div id ="menu">
            <%if (request.getSession().getAttribute(CONFIG.lang).equals("")) {%>
            <jsp:include page="../img/menuList.jsp"></jsp:include>
            <%} else {%>
            <jsp:include page="../img/menuListar.jsp"></jsp:include>                         <%}%>
            </div>
            <div class="content_body">   
                <form name="getTransAg" action="<%=CONFIG.APP_ROOT%>walletServices" method="post" onsubmit="submitForm()" align="center" >
                <table align="menu" style="margin-right: 100px; margin-bottom:0px; " cellspacing="20 px" >
                    <tr>
                        <td>
                            <table border="0" >
                                <%String s = null;
                                    if (requestParameters.get(CONFIG.PARAM_TRANSACTION_TYPE) != null) {
                                        if (requestParameters.get(CONFIG.PARAM_TRANSACTION_TYPE).endsWith("ALL")) {
                                            s = CONFIG.getTransactionsAll(session);
                                        } else if (requestParameters.get(CONFIG.PARAM_TRANSACTION_TYPE).endsWith("FROM")) {
                                            s = CONFIG.getTransactionsFrom(session);
                                        } else {
                                            s = CONFIG.getTransactionsTo(session);
                                        }
                                    }%>
                                <th><%=CONFIG.getTransactionType(session)%></th>
                                <td>
                                    <select name="<%=CONFIG.PARAM_TRANSACTION_TYPE%>">
                                        <option value="<%=requestParameters.get(CONFIG.PARAM_TRANSACTION_TYPE)%>"  <%=requestParameters.get(CONFIG.PARAM_TRANSACTION_TYPE) != null ? "selected" : ""%> ><%=requestParameters.get(CONFIG.PARAM_TRANSACTION_TYPE) == null ? "" : s%></option>
                                        <option value="ALL" <%=requestParameters.get(CONFIG.PARAM_TRANSACTION_TYPE) == null ? "selected" : ""%> ><%=CONFIG.getTransactionsAll(session)%></option>                                            
                                        <option value='FROM'><%=CONFIG.getTransactionsFrom(session)%></option>
                                        <option value='TO'><%=CONFIG.getTransactionsTo(session)%></option>
                                    </select>
                                </td>
                            </table>
                            <br/>
                            <%--<h2>Last transactions</h2>--%>
                            <table border="1" style="border-color: #AACCDE; border-left-color: #AACCDE;border-right-color: #AACCDE;border-top-color: #AACCDE;border-bottom-color: #AACCDE;">
                                <thead>
                                    <tr>
                                        <th rowspan="2">
                                            <h3> <b>  <%=CONFIG.getclientDate(session)%> : </b></h3>
                                        </th>
                                    </tr>
                                </thead>
                                <tr>
                                    <td>
                                        <%=CONFIG.getFrom(session)%> :
                                    </td>
                                    <td>
                                        <% // Calendar cal = Calendar.getInstance();
                                            //cal.set(Calendar.DATE, cal.getActualMinimum(Calendar.DATE));
                                            //Date firstDayOfMonth = cal.getTime();
                                            Calendar cal = Calendar.getInstance();
                                            cal.set(Calendar.DATE, cal.getActualMinimum(Calendar.DATE));
                                            Date firstDayOfMonth;


                                            if (isflag.equals("1")) {
                                                DateFormat format = new SimpleDateFormat("dd-MM-yyyy");
                                                firstDayOfMonth = format.parse(session.getAttribute("newdate").toString());

                                            } else {
                                                firstDayOfMonth = cal.getTime();
//                                           //System.out.println(firstDayOfMonth);
                                            }


                                        %>
                                        <input type="text" class="text" id="From" name="From" tabindex="4" value="<%=requestParameters.get("From") == null ? new SimpleDateFormat("dd-MM-yyyy").format(firstDayOfMonth) : requestParameters.get("From")%>" />
                                        <a href="javascript:NewCal('From','ddmmyyyy')"><img src="bill/cal.gif" width="16" height="16" border="0" alt="Pick a date"/></a>
                                    </td>  
                                </tr>
                                <tr>
                                    <td>
                                        <%=CONFIG.getTo(session)%> :
                                    </td>
                                    <td>
                                        <%
                                            Date lastDayOfMonth;
                                            if (isflag.equals("1")) {
                                                DateFormat format = new SimpleDateFormat("dd-MM-yyyy");
                                                lastDayOfMonth = format.parse(session.getAttribute("newdate").toString());

                                            } else {
                                                // firstDayOfMonth = cal.getTime();
                                                lastDayOfMonth = new Date();
//                                           //System.out.println(firstDayOfMonth);
                                            }
                                            //}
%>

                                        <input type="text" class="text" id="To" name="To" tabindex="4" value="<%=requestParameters.get("To") == null ? new SimpleDateFormat("dd-MM-yyyy").format(lastDayOfMonth) : requestParameters.get("To")%>" />
                                        <a href="javascript:NewCal('To','ddmmyyyy')"><img src="bill/cal.gif" width="16" height="16" border="0" alt="Pick a date"/></a>
                                    </td>  
                                </tr>    
                            </table>
                            <table align="right" style="border-color: #AACCDE; ">
                                <input type="hidden" name="action" value="<%=CONFIG.ACTION_INCLUDE_TRANS_AG%>" />
                                <thead><tr><td><input type="submit" style="height: 37px; width: 77px"  name="btnSubmit" value="<%=CONFIG.getGo(session)%>"/></td></tr></thead>
                            </table>

                        </td>
                        <td>
                            <div class="displayTableFrame"  name="servDiv" id="servDiv">
                                <table border="0"   style="width: 100%" id="servTab" name="servTab" >
                                    <tr>
                                        <th >
                                            <input type="checkbox" <%=session.getAttribute("agentServices") == null ? "checked" : ""%>   name="allCheck"  onClick="selectallMe()" >               
                                        </th>
                                        <td>
                                            <%=CONFIG.getAllServices(session)%>
                                        </td>
                                    </tr>
                                    <%
                                        session.setAttribute("agentServices", serviceList);
                                        int i = 0;
                                        for (CustomerServiceDTO agentService : serviceList) {
                                            String sn = requestParameters.get(Integer.toString(agentService.getServiceID()));
                                    %>
                                    <tr>
                                        <th>
                                            <input id="chkName" onselect="selectall()" type="checkbox" <%=sn == null ? "" : (sn.equals("on") ? "checked " : "")%>  
                                                   name="<%=agentService.getServiceID()%>" tabindex="<%=5 + i%>">
                                        </th>
                                        <td>
                                            <%=agentService.getServiceName(session)%>
                                        </td>
                                    </tr>
                                    <%    }
                                    %>
                                </table>
                            </div>
                        </td>
                    </tr>
                </table>
            </form>
            <div align="right" >        
                <%
                    try {
                        if (session.getAttribute("include") == "transFromAg") {
                            length = transFromAg.size();
                            String page1 = "../customer/TransactionFromAg.jsp?al=" + endOfLoop;
                %>
                <jsp:include page="<%=page1%>"></jsp:include>
                <%
                } else if (session.getAttribute("include") == "transToAg") {
                    length = transToAg.size();
                %>
                <jsp:include page="../customer/TransactionToAg.jsp?al=<%=endOfLoop%>"></jsp:include>

                <%                        }
                    } catch (NullPointerException ex) {
                        MasaryManager.logger.error(ex);
                    }
                    endOfLoop = 10;
                %>
            </div>
        </div><!-- End of Table Content area-->
        <!-- End content body -->
        <div style="clear: both;">&nbsp;</div>

    </div><!-- End of Main body-->

</body>
</html>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      